<!-- Best Sellers Carousel -->
<div class="w-full relative bg-[#252422] py-12">
    <div class="container mx-auto px-4">
        <div class="flex items-center justify-center mb-10">
            <div class="h-0.5 w-12 bg-[#D90429] mr-4"></div>
            <h2 class="text-3xl md:text-4xl font-bold text-center text-[#FFFCF2]">Nos Best-Sellers</h2>
            <div class="h-0.5 w-12 bg-[#D90429] ml-4"></div>
        </div>
        
        <!-- Carousel Container -->
        <div id="bestsellers-carousel" class="carousel-container relative overflow-hidden">
            <!-- Slides Container -->
            <div class="carousel-slides flex transition-all duration-700 ease-in-out">
                <!-- Slide 1 -->
                <div class="carousel-slide w-full flex-shrink-0">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Product 1 -->
                        <div class="bg-[#403D39] rounded-lg overflow-hidden shadow-lg group hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
                            <div class="relative h-64 overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1553621042-f6e147245754?q=80&w=2425&auto=format&fit=crop" alt="Sushi Maki" 
                                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/0 to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <div class="absolute top-3 right-3 bg-[#D90429] text-white rounded-full px-3 py-1 text-sm font-bold shadow-lg">
                                    Best-seller
                                </div>
                                <div class="absolute bottom-4 left-4 transform translate-y-8 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                                        <i class="fa-solid fa-star text-yellow-400"></i> 4.9 (124 avis)
                                    </span>
                                </div>
                            </div>
                            <div class="p-5">
                                <h3 class="text-xl font-semibold mb-2 text-[#FFFCF2]">California Rolls</h3>
                                <p class="text-[#CCC5B9] mb-4">Avocat, concombre, surimi, sésame</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-[#FFFCF2] font-bold text-lg">12.90 €</span>
                                    <button class="bg-[#D90429] hover:bg-[#ce0006] text-white px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fa-solid fa-cart-plus mr-2"></i> Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product 2 -->
                        <div class="bg-[#403D39] rounded-lg overflow-hidden shadow-lg group hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
                            <div class="relative h-64 overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1579871494447-9811cf80d66c?q=80&w=2970&auto=format&fit=crop" alt="Sushi Nigiri" 
                                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/0 to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <div class="absolute top-3 right-3 bg-[#D90429] text-white rounded-full px-3 py-1 text-sm font-bold shadow-lg">
                                    Best-seller
                                </div>
                                <div class="absolute bottom-4 left-4 transform translate-y-8 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                                        <i class="fa-solid fa-star text-yellow-400"></i> 4.8 (97 avis)
                                    </span>
                                </div>
                            </div>
                            <div class="p-5">
                                <h3 class="text-xl font-semibold mb-2 text-[#FFFCF2]">Sushi Mix</h3>
                                <p class="text-[#CCC5B9] mb-4">Assortiment de 12 sushis variés</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-[#FFFCF2] font-bold text-lg">18.90 €</span>
                                    <button class="bg-[#D90429] hover:bg-[#ce0006] text-white px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fa-solid fa-cart-plus mr-2"></i> Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product 3 -->
                        <div class="bg-[#403D39] rounded-lg overflow-hidden shadow-lg group hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
                            <div class="relative h-64 overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1617196034183-421b4917c92d?q=80&w=1000&auto=format&fit=crop" alt="Sushi Sashimi" 
                                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/0 to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <div class="absolute top-3 right-3 bg-[#D90429] text-white rounded-full px-3 py-1 text-sm font-bold shadow-lg">
                                    Best-seller
                                </div>
                                <div class="absolute bottom-4 left-4 transform translate-y-8 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                                        <i class="fa-solid fa-star text-yellow-400"></i> 4.7 (156 avis)
                                    </span>
                                </div>
                            </div>
                            <div class="p-5">
                                <h3 class="text-xl font-semibold mb-2 text-[#FFFCF2]">Plateau Royal</h3>
                                <p class="text-[#CCC5B9] mb-4">24 pièces assorties, parfait à partager</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-[#FFFCF2] font-bold text-lg">26.90 €</span>
                                    <button class="bg-[#D90429] hover:bg-[#ce0006] text-white px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fa-solid fa-cart-plus mr-2"></i> Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Slide 2 -->
                <div class="carousel-slide w-full flex-shrink-0">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Product 4 -->
                        <div class="bg-[#403D39] rounded-lg overflow-hidden shadow-lg group hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
                            <div class="relative h-64 overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1635343833998-b0e58f5fbcc3?q=80&w=3280&auto=format&fit=crop" alt="Sushi Spicy" 
                                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/0 to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <div class="absolute top-3 right-3 bg-[#D90429] text-white rounded-full px-3 py-1 text-sm font-bold shadow-lg">
                                    Nouveauté
                                </div>
                                <div class="absolute bottom-4 left-4 transform translate-y-8 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                                        <i class="fa-solid fa-star text-yellow-400"></i> 4.6 (82 avis)
                                    </span>
                                </div>
                            </div>
                            <div class="p-5">
                                <h3 class="text-xl font-semibold mb-2 text-[#FFFCF2]">Spicy Tuna Rolls</h3>
                                <p class="text-[#CCC5B9] mb-4">Thon épicé, avocat, tempura</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-[#FFFCF2] font-bold text-lg">14.90 €</span>
                                    <button class="bg-[#D90429] hover:bg-[#ce0006] text-white px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fa-solid fa-cart-plus mr-2"></i> Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product 5 -->
                        <div class="bg-[#403D39] rounded-lg overflow-hidden shadow-lg group hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
                            <div class="relative h-64 overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1595456982104-14cc660c4d22?q=80&w=2187&auto=format&fit=crop" alt="Ramen" 
                                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/0 to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <div class="absolute top-3 right-3 bg-[#D90429] text-white rounded-full px-3 py-1 text-sm font-bold shadow-lg">
                                    Populaire
                                </div>
                                <div class="absolute bottom-4 left-4 transform translate-y-8 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                                        <i class="fa-solid fa-star text-yellow-400"></i> 4.5 (107 avis)
                                    </span>
                                </div>
                            </div>
                            <div class="p-5">
                                <h3 class="text-xl font-semibold mb-2 text-[#FFFCF2]">Ramen Tonkotsu</h3>
                                <p class="text-[#CCC5B9] mb-4">Bouillon riche, porc, œuf mariné</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-[#FFFCF2] font-bold text-lg">15.90 €</span>
                                    <button class="bg-[#D90429] hover:bg-[#ce0006] text-white px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fa-solid fa-cart-plus mr-2"></i> Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product 6 -->
                        <div class="bg-[#403D39] rounded-lg overflow-hidden shadow-lg group hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
                            <div class="relative h-64 overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1540648639573-8c848de23f0a?q=80&w=3024&auto=format&fit=crop" alt="Gyoza" 
                                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/0 to-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <div class="absolute top-3 right-3 bg-[#D90429] text-white rounded-full px-3 py-1 text-sm font-bold shadow-lg">
                                    Best-seller
                                </div>
                                <div class="absolute bottom-4 left-4 transform translate-y-8 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                    <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                                        <i class="fa-solid fa-star text-yellow-400"></i> 4.8 (118 avis)
                                    </span>
                                </div>
                            </div>
                            <div class="p-5">
                                <h3 class="text-xl font-semibold mb-2 text-[#FFFCF2]">Gyoza Crispy</h3>
                                <p class="text-[#CCC5B9] mb-4">Raviolis japonais au porc et légumes</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-[#FFFCF2] font-bold text-lg">8.90 €</span>
                                    <button class="bg-[#D90429] hover:bg-[#ce0006] text-white px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fa-solid fa-cart-plus mr-2"></i> Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Arrows -->
            <button id="prevSlide" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-[#D90429]/80 hover:bg-[#D90429] text-white w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center shadow-lg z-10 focus:outline-none transition duration-300">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            
            <button id="nextSlide" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-[#D90429]/80 hover:bg-[#D90429] text-white w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center shadow-lg z-10 focus:outline-none transition duration-300">
                <i class="fa-solid fa-chevron-right"></i>
            </button>
            
            <!-- Slide Indicators -->
            <div class="flex justify-center mt-8">
                <div class="carousel-indicators flex space-x-2">
                    <button class="carousel-indicator w-8 h-2 md:w-10 md:h-2 rounded-full bg-[#FFFCF2] mx-1 transition-all duration-300 active" data-slide="0"></button>
                    <button class="carousel-indicator w-2 h-2 rounded-full bg-[#FFFCF2] opacity-50 mx-1 transition-all duration-300" data-slide="1"></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('bestsellers-carousel');
        const slides = carousel.querySelector('.carousel-slides');
        const prevButton = document.getElementById('prevSlide');
        const nextButton = document.getElementById('nextSlide');
        const indicators = carousel.querySelectorAll('.carousel-indicator');
        const slideItems = carousel.querySelectorAll('.carousel-slide');
        
        let currentSlide = 0;
        const slideCount = slideItems.length;
        let slidesWidth;
        let isDragging = false;
        let startPos = 0;
        let currentTranslate = 0;
        let prevTranslate = 0;
        let animationID = 0;
        let isTransitioning = false;
        
        // Clone first and last slides for infinite effect
        const firstSlideClone = slideItems[0].cloneNode(true);
        const lastSlideClone = slideItems[slideCount - 1].cloneNode(true);
        slides.appendChild(firstSlideClone);
        slides.insertBefore(lastSlideClone, slideItems[0]);
        
        // Initialize carousel dimensions
        function setSlidePosition(transition = true) {
            slidesWidth = carousel.querySelector('.carousel-slide').offsetWidth;
            
            if (!transition) {
                slides.style.transition = 'none';
            } else {
                slides.style.transition = 'transform 700ms ease-in-out';
            }
            
            slides.style.transform = `translateX(-${(currentSlide + 1) * slidesWidth}px)`;
            
            // Force reflow
            if (!transition) {
                void slides.offsetHeight;
            }
        }
        
        // Update indicators appearance
        function updateIndicators() {
            // Make sure we're using the correct index for indicators
            let indicatorIndex = currentSlide;
            
            // Handle edge cases for infinite loop
            if (currentSlide < 0) {
                indicatorIndex = slideCount - 1;
            } else if (currentSlide >= slideCount) {
                indicatorIndex = 0;
            }
            
            indicators.forEach((indicator, index) => {
                if (index === indicatorIndex) {
                    indicator.classList.add('active');
                    indicator.classList.remove('opacity-50');
                    indicator.classList.add('w-8', 'md:w-10');
                    indicator.classList.remove('w-2');
                } else {
                    indicator.classList.remove('active');
                    indicator.classList.add('opacity-50');
                    indicator.classList.remove('w-8', 'md:w-10');
                    indicator.classList.add('w-2');
                }
            });
        }
        
        // Navigate to specific slide
        function goToSlide(index) {
            if (isTransitioning) return;
            
            isTransitioning = true;
            currentSlide = index;
            
            // Update indicators immediately for better user feedback
            updateIndicators();
            
            slides.style.transition = 'transform 700ms ease-in-out';
            
            if (currentSlide === slideCount) {
                slides.style.transform = `translateX(-${(currentSlide + 1) * slidesWidth}px)`;
                
                setTimeout(() => {
                    slides.style.transition = 'none';
                    currentSlide = 0;
                    slides.style.transform = `translateX(-${(currentSlide + 1) * slidesWidth}px)`;
                    
                    // Force reflow
                    void slides.offsetHeight;
                    
                    // Update indicators again after reset
                    updateIndicators();
                    
                    isTransitioning = false;
                }, 700);
            } else if (currentSlide === -1) {
                slides.style.transform = `translateX(-${(currentSlide + 1) * slidesWidth}px)`;
                
                setTimeout(() => {
                    slides.style.transition = 'none';
                    currentSlide = slideCount - 1;
                    slides.style.transform = `translateX(-${(currentSlide + 1) * slidesWidth}px)`;
                    
                    // Force reflow
                    void slides.offsetHeight;
                    
                    // Update indicators again after reset
                    updateIndicators();
                    
                    isTransitioning = false;
                }, 700);
            } else {
                slides.style.transform = `translateX(-${(currentSlide + 1) * slidesWidth}px)`;
                setTimeout(() => {
                    isTransitioning = false;
                }, 700);
            }
        }
        
        // Touch events for mobile swipe
        function touchStart(event) {
            if (isTransitioning) return;
            
            event.stopPropagation();
            isDragging = true;
            startPos = getPositionX(event);
            animationID = requestAnimationFrame(animation);
            slides.style.transition = 'none';
            
            // Pause auto-slide during touch interaction
            clearInterval(autoSlideTimer);
            autoSlideTimer = null;
            isAutoslidePaused = true;
        }
        
        function touchMove(event) {
            if (isDragging) {
                event.stopPropagation();
                const currentPosition = getPositionX(event);
                currentTranslate = prevTranslate + currentPosition - startPos;
            }
        }
        
        function touchEnd(event) {
            if (event) {
                event.stopPropagation();
            }
            
            if (!isDragging) return;
            
            isDragging = false;
            cancelAnimationFrame(animationID);
            
            const movedBy = currentTranslate - prevTranslate;
            
            // Reset transition for slide movement
            slides.style.transition = 'transform 700ms ease-in-out';
            
            // Determine if should advance slide based on swipe distance
            if (movedBy < -100) {
                goToSlide(currentSlide + 1);
            } else if (movedBy > 100) {
                goToSlide(currentSlide - 1);
            } else {
                goToSlide(currentSlide);
            }
            
            prevTranslate = currentTranslate;
            
            // Restart auto-slide after touch interaction
            setTimeout(() => {
                isAutoslidePaused = false;
                restartAutoSlide();
            }, 700); // Wait for transition to complete
        }
        
        function getPositionX(event) {
            return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
        }
        
        function animation() {
            const currentPosition = (currentSlide + 1) * slidesWidth + (currentTranslate - prevTranslate);
            slides.style.transform = `translateX(-${currentPosition}px)`;
            if (isDragging) requestAnimationFrame(animation);
        }
        
        // Initialize carousel
        setTimeout(() => {
            setSlidePosition(false);
            updateIndicators();
            
            // Enable transitions after initial setup
            setTimeout(() => {
                slides.style.transition = 'transform 700ms ease-in-out';
            }, 50);
            
            // Add event listeners
            prevButton.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isTransitioning) {
                    // Stop any existing auto-slide before manually advancing
                    clearInterval(autoSlideTimer);
                    autoSlideTimer = null;
                    
                    goToSlide(currentSlide - 1);
                    
                    // Restart auto-slide timer when user interacts
                    restartAutoSlide();
                }
            });
            
            nextButton.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isTransitioning) {
                    // Stop any existing auto-slide before manually advancing
                    clearInterval(autoSlideTimer);
                    autoSlideTimer = null;
                    
                    goToSlide(currentSlide + 1);
                    
                    // Restart auto-slide timer when user interacts
                    restartAutoSlide();
                }
            });
            
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!isTransitioning) {
                        // Stop any existing auto-slide before manually changing slide
                        clearInterval(autoSlideTimer);
                        autoSlideTimer = null;
                        
                        goToSlide(index);
                        
                        // Restart auto-slide timer when user interacts
                        restartAutoSlide();
                    }
                });
            });
            
            // Add touch event listeners
            slides.addEventListener('touchstart', touchStart);
            slides.addEventListener('touchmove', touchMove);
            slides.addEventListener('touchend', touchEnd);
            slides.addEventListener('mousedown', touchStart);
            slides.addEventListener('mousemove', touchMove);
            slides.addEventListener('mouseup', touchEnd);
            slides.addEventListener('mouseleave', touchEnd);
            
            // Prevent context menu on long press
            carousel.addEventListener('contextmenu', e => {
                if (e.target.closest('.carousel-slides')) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            });
            
            // Auto-slide functionality
            let autoSlideTimer;
            
            function startAutoSlide() {
                // Clear any existing timer first to prevent multiple timers
                if (autoSlideTimer) {
                    clearInterval(autoSlideTimer);
                }
                
                autoSlideTimer = setInterval(() => {
                    if (!isTransitioning && !isDragging) {
                        goToSlide(currentSlide + 1);
                    }
                }, 5000); // Change slide every 5 seconds
            }
            
            function restartAutoSlide() {
                // Make sure to clear the timer first
                clearInterval(autoSlideTimer);
                autoSlideTimer = null;
                
                // Start a new timer after a short delay
                setTimeout(() => {
                    startAutoSlide();
                }, 300);
            }
            
            // Track if auto-slide is paused
            let isAutoslidePaused = false;
            
            // Start auto-slide on page load
            startAutoSlide();
            
            // Pause auto-slide when user interacts with carousel
            carousel.addEventListener('mouseenter', () => {
                isAutoslidePaused = true;
                clearInterval(autoSlideTimer);
                autoSlideTimer = null;
            });
            
            // Resume auto-slide when user leaves the carousel
            carousel.addEventListener('mouseleave', () => {
                if (!isDragging && isAutoslidePaused) {
                    isAutoslidePaused = false;
                    startAutoSlide();
                }
            });
        }, 100);
        
        // Handle resize events
        window.addEventListener('resize', () => {
            setSlidePosition(false);
        });
    });
</script> 